"use strict";(globalThis.webpackChunkamigo_docs=globalThis.webpackChunkamigo_docs||[]).push([[6265],{6322:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"manual/define-problem/models","title":"Models","description":"The Model class is responsible for assembling individual components into a complete optimization problem. It manages component instantiation, variable linking, code generation, and compilation.","source":"@site/docs/manual/define-problem/models.md","sourceDirName":"manual/define-problem","slug":"/manual/define-problem/models","permalink":"/amigo/docs/manual/define-problem/models","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Objectives","permalink":"/amigo/docs/manual/define-problem/objectives"},"next":{"title":"Solve a problem","permalink":"/amigo/docs/manual/solve-problem"}}');var o=i(4848),t=i(8453);const l={sidebar_position:5},a="Models",d={},c=[{value:"Creating a Model",id:"creating-a-model",level:2},{value:"Adding Components",id:"adding-components",level:2},{value:"Single Instance",id:"single-instance",level:3},{value:"Multiple Instances",id:"multiple-instances",level:3},{value:"Variable Linking",id:"variable-linking",level:2},{value:"Basic Linking",id:"basic-linking",level:3},{value:"Array Linking",id:"array-linking",level:3},{value:"Linking Across Instances",id:"linking-across-instances",level:3},{value:"Linking Rules",id:"linking-rules",level:3},{value:"Build and Initialize",id:"build-and-initialize",level:2},{value:"The Build Process",id:"the-build-process",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Sub-Models",id:"sub-models",level:2}];function r(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"models",children:"Models"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Model"})," class is responsible for assembling individual components into a complete optimization problem. It manages component instantiation, variable linking, code generation, and compilation."]}),"\n",(0,o.jsx)(n.h2,{id:"creating-a-model",children:"Creating a Model"}),"\n",(0,o.jsx)(n.p,{children:"A model is created with a unique name that will be used for generated C++ files:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import amigo as am\n\nmodel = am.Model("my_optimization")\n'})}),"\n",(0,o.jsx)(n.p,{children:"The model name should be a valid Python identifier (no spaces or special characters)."}),"\n",(0,o.jsx)(n.h2,{id:"adding-components",children:"Adding Components"}),"\n",(0,o.jsxs)(n.p,{children:["Components are added to the model using ",(0,o.jsx)(n.code,{children:"add_component"}),", which takes three arguments:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"add_component(name, num_instances, component_object)\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"name"}),": Unique identifier for this component group"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"num_instances"}),": Number of instances to create"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"component_object"}),": Instance of your Component class"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"single-instance",children:"Single Instance"}),"\n",(0,o.jsx)(n.p,{children:"For static analysis or single-point optimization:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'rosenbrock = Rosenbrock()\nmodel.add_component("opt", 1, rosenbrock)\n'})}),"\n",(0,o.jsx)(n.h3,{id:"multiple-instances",children:"Multiple Instances"}),"\n",(0,o.jsx)(n.p,{children:"For time-dependent problems, repeated structures, or spatial discretization:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Optimal control with 100 time steps\ndynamics = DynamicsComponent()\nmodel.add_component("dynamics", 100, dynamics)\n\n# This creates 100 copies of the component\n'})}),"\n",(0,o.jsx)(n.p,{children:"Each instance maintains its own variables, indexed from 0 to num_instances-1."}),"\n",(0,o.jsx)(n.h2,{id:"variable-linking",children:"Variable Linking"}),"\n",(0,o.jsxs)(n.p,{children:["Linking establishes relationships between variables across components. The linking syntax uses scoped names: ",(0,o.jsx)(n.code,{children:"component_name.variable_name[indices]"})]}),"\n",(0,o.jsx)(n.h3,{id:"basic-linking",children:"Basic Linking"}),"\n",(0,o.jsx)(n.p,{children:"Link two inputs together (they become the same variable):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Link inputs from two components\nmodel.link("comp1.x", "comp2.x")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"array-linking",children:"Array Linking"}),"\n",(0,o.jsx)(n.p,{children:"Link array elements or slices (inputs to inputs):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Link entire array of inputs\nmodel.link("comp1.forces[:3]", "comp2.forces[:3]")\n\n# Link specific elements\nmodel.link("comp1.load[0]", "comp2.load")\n\n# Link with different indices\nmodel.link("comp1.state[0:3]", "comp2.state[1:4]")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"linking-across-instances",children:"Linking Across Instances"}),"\n",(0,o.jsx)(n.p,{children:"For time-marching or sequential processes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'num_steps = 50\n\n# Link state at end of step k to state at start of step k+1\nfor k in range(num_steps - 1):\n    model.link(f"dynamics.q_end[{k}, :]", f"dynamics.q_start[{k+1}, :]")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"linking-rules",children:"Linking Rules"}),"\n",(0,o.jsxs)(n.p,{children:["Variables are linked between components through an explicit linking process. Indices within the model are linked with text-based linking arguments. The names provided to the linking command are scoped by ",(0,o.jsx)(n.code,{children:"component_name.variable_name"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Inputs to Inputs"}),": Linking establishes that two inputs from different components are the same variable (shared)"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'model.link("comp1.x", "comp2.x")\n# comp1.x and comp2.x are now the same variable\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Outputs to Outputs"}),": Linking two outputs together means the sum of the two output values"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'model.link("comp1.force", "comp2.force")\n# The sum: comp1.force + comp2.force\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Constraints to Constraints"}),": Linking two constraints together means the sum of the constraint values"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'model.link("comp1.residual", "comp2.residual")\n# The sum: comp1.residual + comp2.residual\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"You cannot link between different variable types. For instance, you cannot link inputs to constraints or outputs to objectives."})}),"\n",(0,o.jsx)(n.h2,{id:"build-and-initialize",children:"Build and Initialize"}),"\n",(0,o.jsx)(n.p,{children:"After adding all components and links, compile and initialize:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"# Generate and compile C++ code with automatic differentiation\nmodel.build_module()\n\n# Initialize the model (allocate memory, set initial values)\nmodel.initialize()\n"})}),"\n",(0,o.jsx)(n.h3,{id:"the-build-process",children:"The Build Process"}),"\n",(0,o.jsxs)(n.p,{children:["When ",(0,o.jsx)(n.code,{children:"build_module()"})," is called:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Python code in ",(0,o.jsx)(n.code,{children:"compute()"})," methods is analyzed"]}),"\n",(0,o.jsx)(n.li,{children:"Optimized C++ code is generated"}),"\n",(0,o.jsx)(n.li,{children:"Automatic differentiation (A2D) is incorporated"}),"\n",(0,o.jsx)(n.li,{children:"Code is compiled to a Python extension module"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Generated files:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{model_name}.cpp"})," - C++ source"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{model_name}.h"})," - Header file"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{model_name}.pyd/.so"})," - Compiled binary"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Whenever you modify ",(0,o.jsx)(n.code,{children:"compute()"})," methods, you must call ",(0,o.jsx)(n.code,{children:"build_module()"})," again to recompile."]})}),"\n",(0,o.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import amigo as am\n\n# Define components\nclass Dynamics(am.Component):\n    def __init__(self):\n        super().__init__()\n        self.add_input("x", shape=2)  # Current state\n        self.add_input("u")           # Control input\n        self.add_input("x_next", shape=2)  # Next state\n        self.add_constraint("residual", shape=2)\n    \n    def compute(self):\n        x = self.inputs["x"]\n        u = self.inputs["u"]\n        x_next = self.inputs["x_next"]\n        \n        # Simple dynamics: x_next = f(x, u)\n        dt = 0.1\n        self.constraints["residual"] = [\n            x_next[0] - (x[0] + dt * x[1]),\n            x_next[1] - (x[1] + dt * u)\n        ]\n\nclass Objective(am.Component):\n    def __init__(self):\n        super().__init__()\n        self.add_input("x_final", shape=2)\n        self.add_objective("cost")\n    \n    def compute(self):\n        x = self.inputs["x_final"]\n        # Minimize distance from origin\n        self.objective["cost"] = x[0]**2 + x[1]**2\n\n# Build model\nmodel = am.Model("trajectory")\n\n# Add components (10 time steps)\nnum_steps = 10\nmodel.add_component("dynamics", num_steps, Dynamics())\nmodel.add_component("obj", 1, Objective())\n\n# Link states across time steps (input to input)\nfor k in range(num_steps - 1):\n    model.link(f"dynamics.x_next[{k}, :]", f"dynamics.x[{k+1}, :]")\n\n# Link final state to objective (input to input)\nmodel.link(f"dynamics.x[{num_steps-1}, :]", "obj.x_final")\n\n# Build and initialize\nmodel.build_module()\nmodel.initialize()\n\n# Now ready for optimization\nopt = am.Optimizer(model)\nopt.optimize()\n'})}),"\n",(0,o.jsx)(n.h2,{id:"sub-models",children:"Sub-Models"}),"\n",(0,o.jsxs)(n.p,{children:["You can add sub-models to a model by calling ",(0,o.jsx)(n.code,{children:'model.add_sub_model("sub_model", sub_model)'}),". In this case, the scope becomes ",(0,o.jsx)(n.code,{children:"sub_model.component_name.variable_name"}),". Any links specified in the sub-model are automatically added to the main model."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Create sub-model for wing analysis\nwing = am.Model("wing")\nwing.add_component("aero", 1, AeroComponent())\nwing.add_component("structure", 1, StructureComponent())\n# Link shared input between components (e.g., both need velocity)\nwing.link("aero.velocity", "structure.velocity")\n\n# Create main aircraft model\naircraft = am.Model("aircraft")\naircraft.add_sub_model("left_wing", wing)\naircraft.add_sub_model("right_wing", wing)\n\n# Add a component that takes total weight as input\naircraft.add_component("performance", 1, PerformanceComponent())\n\n# Link wing weight inputs to performance component (input to input)\naircraft.link("left_wing.structure.weight_input", "performance.weight_left")\naircraft.link("right_wing.structure.weight_input", "performance.weight_right")\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Variable paths in sub-models use the format: ",(0,o.jsx)(n.code,{children:"sub_model_name.component_name.variable_name"})]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(r,{...e})}):r(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(6540);const o={},t=s.createContext(o);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);